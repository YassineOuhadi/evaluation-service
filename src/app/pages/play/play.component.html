<div class="center-container" [style.direction]="getLayoutDirection()">
  <div mat-dialog-content class="flex-container">
    <div class="card-container">
      <mat-card class="shadow-md box p-0">
        <mat-card-content>

          <header [@slideDownUp]>
            <div class="title" (click)="onClickTitle()">{{ content.header.title[this.currentLanguage] }}</div>
            <ng-container *ngIf="!isMiniQuiz && !showWarning && questionsList.length>0">
              <div class="timer"
                *ngIf="questionsList[this.currentQuestionNo].question.isWithTiming && remainingTime !== 0" [@fadeInOut]>
                <div class="time_left_txt">{{ content.timer.timeOff[this.currentLanguage] }}</div>
                <div class="timer_sec">{{remainingTime}}</div>
              </div>
            </ng-container>

          </header>

          <section [ngClass]="{ 'grid p-0': isQuizEnded , 'full' : isQuizEnded && !isMiniQuiz}">

            <!--<ng-container *ngIf="showWarning">
              <div class="content_box rules rounded">
              <div class="info-title"><span>{{ content.quizRules[this.currentLanguage] }}</span></div>
              <div class="info-list">
                  <div class="info" *ngFor="let rule of content.ruleList[this.currentLanguage]">{{ rule }}</div>
                  <div class="info">1. You will have only <span>15 seconds</span> per each question.</div>
                  <div class="info">2. Once you select your answer, it can't be undone.</div>
                  <div class="info">3. You can't select any option once time goes off.</div>
                  <div class="info">4. You can't exit from the Quiz Once Started.</div>
              </div>
              </div>
            </ng-container>-->

            <ng-container *ngIf="showWarning">
              <div class="scrolling-form-container__pane-left" style="min-height: calc(100vh - 160px);">
                <div class="left-pane d-flex flex-column align-items-start justify-content-between">
                  <div class="left-pane__logo-wrapper" role="banner">
                    <h3 class="left-pane__company-name">AWARINO</h3>
                  </div>
                  <div class="left-pane__top">
                    <h1 class="left-pane__test-name" aria-label="Welcome to Sample Test">
                      <span class="d-flex" aria-hidden="true">{{ content.messages.welcome[this.currentLanguage]
                        }}</span>
                      <span aria-hidden="true">{{ content.header.title[this.currentLanguage] }}</span>
                    </h1>
                    <div class="info-title"><span>{{ content.quizRules[this.currentLanguage] }}</span></div>
                    <div class="info-list">
                      <div class="info" *ngFor="let rule of content.ruleList[this.currentLanguage]">{{ rule }}</div>
                    </div>
                    <div class="d-flex left-pane__test-detail-container">
                      <div class="left-pane__test-detail">
                        <span class="left-pane__test-detail__header" data-automation="test-duration-text">{{
                          content.messages.testDuration[this.currentLanguage] }}</span>
                        <span class="left-pane__test-detail__content"
                          data-automation="test-duration">{{getTotalTestDurationInMinutes()}} {{
                          content.messages.durationMinutes[this.currentLanguage] }}</span>
                      </div>
                      <!-- nb question from campagn -->
                      <div class="left-pane__test-detail">
                        <span class="left-pane__test-detail__header">{{
                          content.messages.numberOfQuestions[this.currentLanguage] }}</span>
                        <span class="left-pane__test-detail__content">{{totalQuestions}} {{
                          content.messages.questionsCounterQue[this.currentLanguage] }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="isQuizStarted">
              <div class="content_box" *ngIf="questionsList.length>0">

                <div class="que_text">
                  <span>
                    {{nbQuestionsAttempted? nbQuestionsAttempted+currentQuestionNo+1 : currentQuestionNo+1}}.
                    <ng-container
                      *ngIf="questionsList[currentQuestionNo].type === 'FILL_BLANKS'; else showQuestionText">
                      <ng-container *ngIf="questionsList[currentQuestionNo].question.isDragWords">
                        {{ content.que_text.dragWords[this.currentLanguage] }}
                      </ng-container>
                      <ng-container *ngIf="!questionsList[currentQuestionNo].question.isDragWords">
                        {{ content.que_text.fillBlanks[this.currentLanguage] }}
                      </ng-container>
                    </ng-container>
                    <ng-template #showQuestionText>
                      {{questionsList[currentQuestionNo].question.text}}
                    </ng-template>
                  </span>
                </div>

                <div class="option_list"
                  *ngIf="questionsList[currentQuestionNo].type === 'CHOICE' || questionsList[currentQuestionNo].type === 'TRUE_FALSE'">
                  <div class="option" [ngClass]="{'selected': option.isSelected }" (click)="selectOption(option)"
                    *ngFor="let option of questionsList[currentQuestionNo].question.options" [@slideDownUp]>
                    <input type="checkbox" [checked]="option.isSelected" (click)="selectOption(option)"
                      *ngIf="questionsList[currentQuestionNo].question.isMultipleChoice">
                    <input type="radio" [checked]="option.isSelected" (click)="selectOption(option)"
                      *ngIf="!questionsList[currentQuestionNo].question.isMultipleChoice || questionsList[currentQuestionNo].type === 'TRUE_FALSE'">
                    <span class="mx-4">{{option.text}}</span>
                  </div>
                  <div class="content"
                    [ngClass]="{ 'correct': questionsList[currentQuestionNo].question.isCorrect, 'incorrect': !questionsList[currentQuestionNo].question.isCorrect}"
                    *ngIf="isMiniQuiz && questionsList[this.currentQuestionNo].question.isValidate"
                    style="justify-content: flex-start;display: flex;">
                    <mat-icon class="icon"
                      *ngIf="questionsList[currentQuestionNo].question.isCorrect">check_circle</mat-icon>
                    <mat-icon class="icon" *ngIf="!questionsList[currentQuestionNo].question.isCorrect">error</mat-icon>
                    <span *ngIf="questionsList[currentQuestionNo].question.isCorrect" class="text mx-2">{{
                      content.tipText.correctAnswer[this.currentLanguage] }}
                      {{questionsList[currentQuestionNo].question.correctAnswerTipText}}</span>
                    <span *ngIf="!questionsList[currentQuestionNo].question.isCorrect" class="text mx-2">{{
                      content.tipText.incorrectAnswer[this.currentLanguage] }}
                      {{questionsList[currentQuestionNo].question.incorrectAnswerTipText}}</span>
                  </div>
                </div>

                <div class="fill_container"
                  *ngIf="questionsList[currentQuestionNo].type === 'FILL_BLANKS' && !questionsList[currentQuestionNo].question.isDragWords">
                  <div class="content" *ngIf="this.questionsList[this.currentQuestionNo].question.textBlocks"
                    [@fadeInOut]>
                    <ng-container *ngFor="let block of this.questionsList[this.currentQuestionNo].question.textBlocks;">
                      <span class="text" *ngIf="!block.isSelected">{{ block.word }}</span>
                      <div class="input_container" *ngIf="block.isSelected">
                        <input class="input" [(ngModel)]="block.word" (input)="onTextareaInput()"
                          [ngStyle]="{ width: calculateInputWidth(block) }" />
                      </div>
                      <span *ngIf="block.specialCharacter">
                        {{ block.specialCharacter}}
                      </span>
                      {{' '}}
                    </ng-container>
                  </div>
                  <div class="content"
                    [ngClass]="{ 'correct': questionsList[currentQuestionNo].question.isCorrect, 'incorrect': !questionsList[currentQuestionNo].question.isCorrect}"
                    *ngIf="isMiniQuiz && questionsList[this.currentQuestionNo].question.isValidate"
                    style="justify-content: flex-start;display: flex;">
                    <mat-icon class="icon"
                      *ngIf="questionsList[currentQuestionNo].question.isCorrect">check_circle</mat-icon>
                    <mat-icon class="icon" *ngIf="!questionsList[currentQuestionNo].question.isCorrect">error</mat-icon>
                    <span *ngIf="questionsList[currentQuestionNo].question.isCorrect" class="text mx-2">{{
                      content.tipText.correctAnswer[this.currentLanguage] }}
                      {{questionsList[currentQuestionNo].question.correctAnswerTipText}}</span>
                    <span *ngIf="!questionsList[currentQuestionNo].question.isCorrect" class="text mx-2">{{
                      content.tipText.incorrectAnswer[this.currentLanguage] }}
                      {{questionsList[currentQuestionNo].question.incorrectAnswerTipText}}</span>
                  </div>
                </div>

                <!--Drag_Words-->
                <div class="fill_container"
                  *ngIf="questionsList[currentQuestionNo].type === 'FILL_BLANKS' && questionsList[currentQuestionNo].question.isDragWords">
                  <div class="content" *ngIf="hasDraggableHiddenWords()" [@slideDownUp]>
                    <div class="draggable-words">
                      <div *ngFor="let dragWord of questionsList[currentQuestionNo].question.hiddenWords">
                        <span (dragstart)="onDragStart($event, dragWord)" (click)="onClickStart(dragWord)">
                          <div class="draggable-word" *ngIf="dragWord.isDraggable" draggable="true">
                            {{ dragWord.word }}
                          </div>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="content block" *ngIf="this.questionsList[this.currentQuestionNo].question.textBlocks"
                    [@fadeInOut]>
                    <ng-container *ngFor="let block of this.questionsList[this.currentQuestionNo].question.textBlocks;">
                      <span class="text" *ngIf="!block.isSelected">{{ block.word }}</span>
                      <div class="input_container" *ngIf="block.isSelected">
                        <span class="input" role="textbox" contenteditable="false"
                          [attr.placeholder]="getDropHereTranslation()" (dragover)="onDragOver($event)"
                          (click)="onClickEnd()" [draggable]="currentDroppedWord ? 'true' : 'false'"
                          (drop)="onDrop($event,block)">
                          <ng-container *ngIf="block.word">{{block.word}}</ng-container>
                        </span>
                      </div>
                      <span *ngIf="block.specialCharacter">
                        {{ block.specialCharacter}}
                      </span>
                      {{' '}}
                    </ng-container>
                    <div class="refresh-icon" [ngClass]="rightToLeft() ? 'right' : 'left'"
                      (click)="refreshDragDropContent()" *ngIf="!hasDraggableHiddenWords()" [@fadeInOut]>
                      <mat-icon>refresh</mat-icon>
                    </div>
                  </div>
                  <div class="content"
                    [ngClass]="{ 'correct': questionsList[currentQuestionNo].question.isCorrect, 'incorrect': !questionsList[currentQuestionNo].question.isCorrect}"
                    *ngIf="isMiniQuiz && questionsList[this.currentQuestionNo].question.isValidate"
                    style="justify-content: flex-start;display: flex;">
                    <mat-icon class="icon"
                      *ngIf="questionsList[currentQuestionNo].question.isCorrect">check_circle</mat-icon>
                    <mat-icon class="icon" *ngIf="!questionsList[currentQuestionNo].question.isCorrect">error</mat-icon>
                    <span *ngIf="questionsList[currentQuestionNo].question.isCorrect" class="text mx-2">{{
                      content.tipText.correctAnswer[this.currentLanguage] }}
                      {{questionsList[currentQuestionNo].question.correctAnswerTipText}}</span>
                    <span *ngIf="!questionsList[currentQuestionNo].question.isCorrect" class="text mx-2">{{
                      content.tipText.incorrectAnswer[this.currentLanguage] }}
                      {{questionsList[currentQuestionNo].question.incorrectAnswerTipText}}</span>
                  </div>
                </div>
                <!--Drag_Words-->

              </div>
            </ng-container>

            <ng-container *ngIf="isMiniQuiz && isQuizEnded">
              <div class="congratulations-container">
                <div class="congratulations-content">
                  <img src="/assets/badge.png" class="certification-image" alt="Certification Image" />
                  <div class="text-container px-4">
                    <h2 class="congratulations-title">{{
                      content.messages.miniQuizcompletionMessage[this.currentLanguage] }}</h2>
                    <p class="score-text">{{ content.messages.quizScoreText[this.currentLanguage] }} {{
                      correctAnswerCount }} out of {{ questionsList.length }}</p>
                    <p class="score-text">{{ content.messages.quizFinishText[this.currentLanguage] }}</p>
                    <!-- Add any additional content or call-to-action buttons here -->
                  </div>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="!isMiniQuiz && isQuizEnded">
              <div class="main-container">
                <div class="congratulations-container">
                  <div class="congratulations-content">
                    <img src="/assets/badge.png" class="certification-image" alt="Certification Image" />
                    <div class="text-container px-4">
                      <h2 class="congratulations-title">{{
                        content.messages.quizCongratulationsTitle[this.currentLanguage] }}</h2>
                      <p class="score-text">
                        {{ content.messages.quizScoreText[this.currentLanguage] }}
                        {{ score }} out of 100.
                      </p>
                      <p class="score-text">
                        {{ content.messages.quizFinishText[this.currentLanguage] }}
                        {{ content.messages.courseFinishText[this.currentLanguage] }}
                      </p>
                      <footer [ngClass]="{ 'start-buttons': showWarning || isQuizEnded}" [@slideDownUp]>
                        <ng-container *ngIf="isQuizEnded">
                          <button class="exit_btn rounded" (click)="exit()" [@fadeInOut]>
                            {{ content.buttons.quitQuiz[this.currentLanguage] }}
                          </button>
                          <button *ngIf="!questionsList[this.currentQuestionNo].question.isWithTiming 
                              || (questionsList[this.currentQuestionNo].question.isWithTiming && remainingTime == 0) 
                              || isMiniQuiz" class="next_btn rounded" (click)="ReplayQuiz()" [@fadeInOut]>
                            {{ content.buttons.replayQuiz[this.currentLanguage] }}
                          </button>
                        </ng-container>
                      </footer>
                    </div>
                  </div>
                </div>
                <mat-accordion class="questions-accordion" *ngIf="questionsList.length>0">
                  <ng-container *ngFor="let questionObj of questionsList; let i = index" [@slideDownUp]>
                    <mat-expansion-panel>
                      <mat-expansion-panel-header class="mat-expansion-panel-header">
                        <div class="panel-header-content">
                          <mat-panel-title class="title">
                            <div class="que_text">
                              <span>
                                {{i+1}}.
                                <ng-container *ngIf="questionObj.type === 'FILL_BLANKS'; else showQuestionText">
                                  <ng-container *ngIf="questionObj.question.isDragWords">
                                    {{ content.summary.dragWordsQuestion[this.currentLanguage] }}
                                  </ng-container>
                                  <ng-container *ngIf="!questionObj.question.isDragWords">
                                    {{ content.summary.fillBlanksQuestion[this.currentLanguage] }}
                                  </ng-container>
                                </ng-container>
                                <ng-template #showQuestionText>
                                  {{questionObj.question.text}}
                                </ng-template>
                              </span>
                            </div>
                          </mat-panel-title>
                          <div class="score">
                            1/10
                          </div>
                        </div>
                      </mat-expansion-panel-header>
                      <!-- Answer -->
                      <span class="text label">{{ content.summary.yourAnswer[this.currentLanguage] }}</span>
                      <div class="content" [ngClass]="{ 'grid': questionObj.type !== 'FILL_BLANKS', 
                                                        'correct': questionObj.question.isCorrect, 
                                                        'incorrect': !questionObj.question.isCorrect}">
                        <span>
                          <mat-icon class="icon" *ngIf="questionObj.question.isCorrect">check_circle</mat-icon>
                          <mat-icon class="icon" *ngIf="!questionObj.question.isCorrect">error</mat-icon>
                        </span>
                        <ng-container *ngIf="questionObj.type === 'CHOICE' || questionObj.type === 'TRUE_FALSE'">
                          <ng-container *ngFor="let option of questionObj.question.options;">
                            <span class="text option" *ngIf="option.isSelected">
                              {{option.text}}
                            </span>
                          </ng-container>
                          <span class="text" *ngIf="!isOptionSelected(questionObj.question.options)">
                            {{ content.summary.noOptionChosen[this.currentLanguage] }}
                          </span>
                        </ng-container>
                        <ng-container *ngIf="questionObj.type === 'FILL_BLANKS'">
                          <ng-container *ngFor="let block of questionObj.question.textBlocks;">
                            <span class="text" *ngIf="!block.isSelected">{{ block.word }}</span>
                            <div class="input_container" *ngIf="block.isSelected">
                              <span class="input" role="textbox" contenteditable="false">
                                <ng-container *ngIf="block.word">{{block.word}}</ng-container>
                              </span>
                            </div>
                            <span *ngIf="block.specialCharacter">
                              {{ block.specialCharacter}}
                            </span>
                            {{' '}}
                          </ng-container>
                        </ng-container>
                      </div>
                      <!-- Correct answer -->
                      <span class="text label">{{ content.tipText.correctAnswer[this.currentLanguage] }}</span>
                      <div class="content correct" [ngClass]="{ 'grid': questionObj.type !== 'FILL_BLANKS'}">
                        <span>
                          <mat-icon class="icon">check_circle</mat-icon>
                        </span>
                        <span class="text" *ngFor="let response of questionObj.responses">
                          {{response}}
                        </span>
                      </div>
                      <!-- Explanation -->
                      <span class="text label">{{ content.tipText.explanation[this.currentLanguage] }}</span>
                      <div class="content explanation">
                        <span *ngIf="questionObj.question.isCorrect" class="text">
                          {{questionObj.question.correctAnswerTipText}}
                        </span>
                        <span *ngIf="!questionObj.question.isCorrect" class="text">
                          {{questionObj.question.incorrectAnswerTipText}}
                        </span>
                      </div>
                    </mat-expansion-panel>
                  </ng-container>
                </mat-accordion>
              </div>
            </ng-container>

          </section>

          <footer [ngClass]="{ 'start-buttons': showWarning || isQuizEnded}" *ngIf="!(isQuizEnded && !isMiniQuiz)"
            [@slideDownUp]>
            <ng-container *ngIf="showWarning">
              <button mat-raised-button class="exit_btn rounded" (click)="exit()">{{
                content.buttons.exitQuiz[this.currentLanguage] }}</button>

              <button mat-raised-button class="next_btn rounded" *ngIf="isContinueExam" (click)="ContinueQuiz()">{{
                content.buttons.continueQuiz[this.currentLanguage] }}</button>


              <!--=<button mat-raised-button class="next_btn rounded" *ngIf="remainingTime === 0 && !isContinueExam" 
                      (click)="startQuiz()">{{ content.buttons.startQuiz[this.currentLanguage] }}</button>-->

              <button mat-raised-button class="next_btn rounded" *ngIf="!isContinueExam" (click)="startQuiz()">{{
                content.buttons.startQuiz[this.currentLanguage] }}</button>
            </ng-container>

            <ng-container *ngIf="isQuizStarted">
              <div class="total_que">
                <span>
                  <p>{{nbQuestionsAttempted? nbQuestionsAttempted+currentQuestionNo+1 : currentQuestionNo+1}}</p> {{
                  content.messages.questionsCounterOf[this.currentLanguage] }}
                  <p>{{ !isMiniQuiz ? totalQuestions : questionsList.length }}</p>
                  {{ content.messages.questionsCounterQue[this.currentLanguage] }}
                </span>
              </div>
              <div>

                <button class="exit_btn rounded mx-4" (click)="stop()" [@fadeInOut]>{{
                  content.buttons.quitQuiz[this.currentLanguage] }}</button>
                <ng-container *ngIf="currentQuestionNo+1 == questionsList.length">
                  <button *ngIf="(isMiniQuiz && questionsList[this.currentQuestionNo].question.isValidate 
                                && questionsList[this.currentQuestionNo].question.isCorrect ) 
                                || !isMiniQuiz" class="next_btn rounded" (click)="validateAndProceed()" [@fadeInOut]>{{
                    content.buttons.finishQuiz[this.currentLanguage] }}</button>
                </ng-container>


                <button
                  *ngIf="(isMiniQuiz && !questionsList[this.currentQuestionNo].question.isValidate) || (isMiniQuiz && !questionsList[this.currentQuestionNo].question.isCorrect)"
                  class="next_btn rounded" (click)="validateAnswer()" [@fadeInOut]>{{
                  content.buttons.validate[this.currentLanguage] }}</button>

                <ng-container *ngIf="currentQuestionNo+1 !== questionsList.length">
                  <button *ngIf="(isMiniQuiz && questionsList[this.currentQuestionNo].question.isValidate 
                                && questionsList[this.currentQuestionNo].question.isCorrect ) 
                                || !isMiniQuiz" class="next_btn rounded" (click)="nextQuestion()" [@fadeInOut]>{{
                    content.buttons.nextQuestion[this.currentLanguage] }}</button>
                </ng-container>
              </div>
            </ng-container>

            <ng-container *ngIf="isQuizEnded">
              <button class="exit_btn rounded" (click)="exit()" [@fadeInOut]>{{
                content.buttons.quitQuiz[this.currentLanguage] }}</button>
              <button
                *ngIf="!questionsList[this.currentQuestionNo].question.isWithTiming || (questionsList[this.currentQuestionNo].question.isWithTiming && remainingTime == 0) || isMiniQuiz"
                class="next_btn rounded" (click)="ReplayQuiz()" [@fadeInOut]>{{
                content.buttons.replayQuiz[this.currentLanguage] }}</button>
            </ng-container>
          </footer>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>